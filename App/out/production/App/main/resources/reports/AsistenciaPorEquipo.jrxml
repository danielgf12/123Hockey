<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.0.final using JasperReports Library version 6.20.0-2bc7ab61c56f459e8176eb05c7705e145cd400ad  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="AsistenciaPorEquipo" language="groovy" pageWidth="595" pageHeight="842" whenNoDataType="NoPages" columnWidth="515" leftMargin="40" rightMargin="40" topMargin="50" bottomMargin="50" uuid="28926e37-7754-4fa4-8451-ea073bad19f8">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="MySQL-123Hockey"/>
	<parameter name="Equipo" class="java.lang.Integer"/>
	<parameter name="FechaDesde" class="java.sql.Timestamp"/>
	<parameter name="FechaHasta" class="java.sql.Timestamp"/>
	<queryString language="SQL">
		<![CDATA[SELECT 
      u.nombre AS jugador,
      COUNT(e.id) AS total_entrenamientos,
      SUM(CASE WHEN a.asistencia = 1 THEN 1 ELSE 0 END) AS asistencias
    FROM Entrenamiento e
      JOIN Asistencia a ON e.id = a.id_entrenamiento
      JOIN Usuario u     ON u.id = a.id_usuario
      JOIN Equipo_Jugador ej ON ej.id_usuario = u.id
    WHERE ej.id_equipo = $P{Equipo}
      AND e.fecha      >= $P{FechaDesde}
      AND e.fecha      <= $P{FechaHasta}
    GROUP BY u.nombre]]>
	</queryString>
	<field name="jugador" class="java.lang.String"/>
	<field name="total_entrenamientos" class="java.lang.Long"/>
	<field name="asistencias" class="java.lang.Long"/>
	<variable name="porcentaje" class="java.lang.Double">
		<variableExpression><![CDATA[$F{total_entrenamientos} > 0
        ? ($F{asistencias}.doubleValue() / $F{total_entrenamientos}.doubleValue()) * 100
        : 0]]></variableExpression>
	</variable>
	<variable name="avgPorcentaje" class="java.lang.Double" calculation="Average">
		<variableExpression><![CDATA[$V{porcentaje}]]></variableExpression>
	</variable>
	<title>
		<band height="50" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="515" height="30" uuid="7fb445cf-bd3c-4a64-9254-3b8efcca30e1"/>
				<textElement textAlignment="Center">
					<font size="18" isBold="true"/>
				</textElement>
				<text><![CDATA[Asistencia por equipo]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="20" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="200" height="20" uuid="d714bd9d-5587-45ea-a73b-a493258babe0"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Jugador]]></text>
			</staticText>
			<staticText>
				<reportElement x="200" y="0" width="150" height="20" uuid="ba9caa7c-5a14-4528-bb29-60b70a7078f2"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total entrenamientos]]></text>
			</staticText>
			<staticText>
				<reportElement x="350" y="0" width="100" height="20" uuid="7b77b8f5-7c6c-4520-87e0-c142d591b2bb"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Asistencias]]></text>
			</staticText>
			<staticText>
				<reportElement x="450" y="0" width="65" height="20" uuid="21ba06d1-b3e3-44e0-ad97-fff145eded51"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[% Asistencia]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="200" height="20" uuid="9d45936b-c5a5-4d61-b633-dc7a7f8cda8d"/>
				<textFieldExpression><![CDATA[$F{jugador}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="200" y="0" width="150" height="20" uuid="e7ca24b5-e744-4a1a-925d-21bca4606fe3"/>
				<textFieldExpression><![CDATA[$F{total_entrenamientos}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="350" y="0" width="100" height="20" uuid="06c5522f-41e0-41dc-963d-58538c1d61d0"/>
				<textFieldExpression><![CDATA[$F{asistencias}]]></textFieldExpression>
			</textField>
			<textField pattern="##0.00">
				<reportElement x="450" y="0" width="65" height="20" uuid="965e663f-3cd1-4337-b35a-61991ac50cf2"/>
				<textFieldExpression><![CDATA[$V{porcentaje}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="240" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="300" height="20" uuid="f11e2bea-a0ca-4f31-bfec-8db048e3b3e1"/>
				<textFieldExpression><![CDATA["Media de asistencia del equipo: "
           + String.format("%.2f", $V{avgPorcentaje}) + "%"]]></textFieldExpression>
			</textField>
			<barChart>
				<chart evaluationTime="Report">
					<reportElement x="92" y="50" width="330" height="140" uuid="27488ecb-2002-48a7-9d6a-d84a2c7ef91f"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<categoryDataset>
					<dataset resetType="Report"/>
					<categorySeries>
						<seriesExpression><![CDATA["% Asistencia"
]]></seriesExpression>
						<categoryExpression><![CDATA[$F{jugador}]]></categoryExpression>
						<valueExpression><![CDATA[$V{porcentaje}]]></valueExpression>
						<labelExpression><![CDATA["% Asistencia"]]></labelExpression>
						<itemHyperlink hyperlinkTarget="Parent"/>
					</categorySeries>
				</categoryDataset>
				<barPlot>
					<plot/>
					<itemLabel/>
					<categoryAxisFormat>
						<axisFormat labelColor="#000000" tickLabelColor="#000000" axisLineColor="#000000"/>
					</categoryAxisFormat>
					<valueAxisFormat>
						<axisFormat labelColor="#000000" tickLabelColor="#000000" axisLineColor="#000000"/>
					</valueAxisFormat>
				</barPlot>
			</barChart>
		</band>
	</summary>
</jasperReport>
